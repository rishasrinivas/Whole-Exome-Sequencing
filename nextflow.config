// Nextflow configuration file for WES pipeline

// Pipeline information
manifest {
    name = 'WES-Pipeline'
    description = 'Complete Whole Exome Sequencing Analysis Pipeline'
    version = '1.0.0'
    nextflowVersion = '>=23.10.0'
    defaultBranch = 'main'
    author = 'WES Pipeline Team'
}

// Default parameters
params {
    // Input parameters
    input_dir = './data/raw'
    sample_sheet = null
    outdir = './results'
    
    // Reference genome parameters
    ref_genome = null
    ref_genome_fasta = null
    ref_genome_index = null
    dbsnp = null
    known_indels = null
    
    // Target regions for exome
    target_bed = null
    
    // Quality control parameters
    min_read_length = 50
    min_base_quality = 20
    
    // Alignment parameters
    bwa_mem2_threads = 8
    
    // Variant calling parameters
    gatk_java_opts = '-Xmx4g'
    ploidy = 2
    
    // VEP annotation parameters
    vep_cache_dir = null
    vep_species = 'homo_sapiens'
    vep_assembly = 'GRCh38'
    
    // Filtering parameters
    min_dp = 10
    min_gq = 20
    max_missing = 0.1
    
    // Report parameters
    report_title = 'WES Analysis Report'
    
    // Resource parameters
    max_memory = '128.GB'
    max_cpus = 32
    max_time = '240.h'
    
    // Process-specific parameters
    skip_multiqc = false
    save_intermediate = false
    
    // Help
    help = false
}

// Process configuration
process {
    // Default resources
    cpus = 1
    memory = '4.GB'
    time = '4.h'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 3
    
    // Process-specific configurations
    withName: 'FASTQC' {
        cpus = 2
        memory = '2.GB'
        time = '1.h'
    }
    
    withName: 'BWA_MEM2_ALIGN' {
        cpus = params.bwa_mem2_threads
        memory = '16.GB'
        time = '6.h'
    }
    
    withName: 'PICARD_SORT' {
        cpus = 4
        memory = '8.GB'
        time = '2.h'
    }
    
    withName: 'PICARD_MARKDUPLICATES' {
        cpus = 4
        memory = '8.GB'
        time = '2.h'
    }
    
    withName: 'GATK_HAPLOTYPECALLER' {
        cpus = 4
        memory = '12.GB'
        time = '8.h'
    }
    
    withName: 'VEP_ANNOTATE' {
        cpus = 4
        memory = '16.GB'
        time = '4.h'
    }
    
    withName: 'GENERATE_REPORT' {
        cpus = 2
        memory = '4.GB'
        time = '1.h'
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = params.max_cpus
    memory = params.max_memory
}

// Profiles for different execution environments
profiles {
    standard {
        process.executor = 'local'
    }
    
    conda {
        process.conda = './conda.yml'
        conda.enabled = true
    }
    
    docker {
        docker.enabled = true
        process.container = 'biocontainers/mulled-v2-tool'
    }
    
    singularity {
        singularity.enabled = true
        process.container = 'biocontainers/mulled-v2-tool'
    }
    
    cluster {
        process.executor = 'slurm'
        process.queue = 'normal'
        process.clusterOptions = '--account=your_account'
    }
    
    test {
        params.input_dir = './test_data'
        params.outdir = './test_results'
        params.max_memory = '8.GB'
        params.max_cpus = 4
    }
}

// Reporting
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}

// Cleanup
cleanup = true

// Resume settings
resume = true

